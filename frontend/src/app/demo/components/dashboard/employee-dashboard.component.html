<div class="grid">
    <div class="col-12">
        <div class="card">
            <div class="flex justify-content-between align-items-center">
                <div>
                    <h5>Dashboard Employé</h5>
                    <p>Bienvenue dans votre espace personnel de formation.</p>
                </div>
                <!-- Test role switching buttons -->
                <div class="flex gap-2">
                    <small class="text-500">Test rôles:</small>
                    <button pButton pRipple type="button"
                            label="Admin"
                            icon="pi pi-user-plus"
                            class="p-button-success p-button-sm"
                            onclick="localStorage.setItem('keycloak_user', JSON.stringify({id:'1',username:'admin@formation.com',email:'admin@formation.com',name:'Administrator',first_name:'Admin',last_name:'User',roles:['admin'],team:'Administration'})); window.location.reload()"></button>
                    <button pButton pRipple type="button"
                            label="Formateur"
                            icon="pi pi-user-edit"
                            class="p-button-info p-button-sm"
                            onclick="localStorage.setItem('keycloak_user', JSON.stringify({id:'2',username:'trainer@formation.com',email:'trainer@formation.com',name:'Trainer User',first_name:'Trainer',last_name:'User',roles:['trainer'],team:'Formation',specialite:'Informatique'})); window.location.reload()"></button>
                    <button pButton pRipple type="button"
                            label="Employé"
                            icon="pi pi-user"
                            class="p-button-warning p-button-sm"
                            onclick="window.location.reload()"></button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="grid">
    <div class="col-12 lg:col-6 xl:col-3">
        <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3">Mes Formations</span>
                    <div class="text-900 font-medium text-xl">{{ totalFormations }}</div>
                </div>
                <div class="flex align-items-center justify-content-center bg-blue-100 border-round" style="width:2.5rem;height:2.5rem">
                    <i class="pi pi-book text-blue-500 text-xl"></i>
                </div>
            </div>
            <span class="text-green-500 font-medium">{{ upcomingFormations.length }} à venir</span>
            <span class="text-500"> cette semaine</span>
        </div>
    </div>
    <div class="col-12 lg:col-6 xl:col-3">
        <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3">Taux de Présence</span>
                    <div class="text-900 font-medium text-xl">{{ attendanceRate }}%</div>
                </div>
                <div class="flex align-items-center justify-content-center bg-green-100 border-round" style="width:2.5rem;height:2.5rem">
                    <i class="pi pi-check-circle text-green-500 text-xl"></i>
                </div>
            </div>
            <span class="text-green-500 font-medium">Excellent</span>
            <span class="text-500"> performance</span>
        </div>
    </div>
    <div class="col-12 lg:col-6 xl:col-3">
        <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3">Formations Complétées</span>
                    <div class="text-900 font-medium text-xl">{{ completedFormations.length }}</div>
                </div>
                <div class="flex align-items-center justify-content-center bg-cyan-100 border-round" style="width:2.5rem;height:2.5rem">
                    <i class="pi pi-trophy text-cyan-500 text-xl"></i>
                </div>
            </div>
            <span class="text-green-500 font-medium">Terminées</span>
            <span class="text-500"> avec succès</span>
        </div>
    </div>
    <div class="col-12 lg:col-6 xl:col-3">
        <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3">Prochaine Formation</span>
                    <div class="text-900 font-medium text-xl">{{ upcomingFormations.length > 0 ? upcomingFormations[0].name?.substring(0, 10) + '...' : 'Aucune' }}</div>
                </div>
                <div class="flex align-items-center justify-content-center bg-orange-100 border-round" style="width:2.5rem;height:2.5rem">
                    <i class="pi pi-calendar text-orange-500 text-xl"></i>
                </div>
            </div>
            <span class="text-green-500 font-medium">{{ upcomingFormations.length > 0 ? upcomingFormations[0].date : 'N/A' }}</span>
            <span class="text-500"> planifiée</span>
        </div>
    </div>
</div>

<div class="grid">
    <div class="col-12 xl:col-6">
        <div class="card">
            <h5>Actions Rapides</h5>
            <div class="grid">
                <div class="col-6">
                    <button pButton pRipple type="button" 
                            label="Mes Formations" 
                            icon="pi pi-book" 
                            class="p-button-success w-full mb-3"
                            (click)="navigateToMyFormations()"></button>
                </div>
                <div class="col-6">
                    <button pButton pRipple type="button" 
                            label="Historique" 
                            icon="pi pi-history" 
                            class="p-button-info w-full mb-3"
                            (click)="navigateToFormationHistory()"></button>
                </div>
                <div class="col-12">
                    <button pButton pRipple type="button" 
                            label="Documents" 
                            icon="pi pi-file" 
                            class="p-button-warning w-full mb-3"
                            (click)="navigateToDocuments()"></button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-12 xl:col-6">
        <div class="card">
            <h5>Formations à Venir</h5>
            <div *ngIf="upcomingFormations.length === 0" class="text-center p-4">
                <i class="pi pi-info-circle text-4xl text-blue-500 mb-3"></i>
                <p class="text-500">Aucune formation programmée pour le moment.</p>
            </div>
            <div *ngFor="let formation of upcomingFormations" class="border-bottom-1 surface-border py-3">
                <div class="flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1">{{ formation.name }}</h6>
                        <p class="text-500 mb-0">{{ formation.date | date:'dd/MM/yyyy' }}</p>
                    </div>
                    <button pButton pRipple type="button" 
                            icon="pi pi-eye" 
                            class="p-button-text p-button-sm"
                            (click)="viewFormationDetails(formation)"></button>
                </div>
            </div>
        </div>
    </div>
</div>
